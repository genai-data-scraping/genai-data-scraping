(function(h){var m=window.AmazonUIPageJS||window.P,n=m._namespace||m.attributeErrors,b=n?n("NileInlineCustomerExperienceWidgetDPXAssets",""):m;b.guardFatal?b.guardFatal(h)(b,window):b.execute(function(){h(b,window)})})(function(h,m,n){h.now("nile-inline-widget-instrumentation").execute(function(b){b||h.when("nile-inline-state-utils","dp-latency-marker").register("nile-inline-widget-instrumentation",function(b){function k(a){var c=Array.from(arguments).slice(1,arguments.length);return function(){for(var d=
arguments.length,e=Array(d),g=0;g<d;g++)e[g]=arguments[g];a.apply(void 0,c.concat(e))}}function h(a){a=[a.dataset.blueMetrics,a.dataset.actionId];a=a.filter(function(a){return a!==n&&null!==a&&""!==a});return a.join(":")}function f(a){for(var c=Object.keys(a),d=0;d<c.length;d++){var e=c[d],g=a[e];null===g||g===n?g="":"number"===typeof g&&(g=g.toString());a[e]=g}return a}function p(a,c){var d=(d=document.cookie.match(/(?:^|;)\s*amzn-app-id\s*=\s*([^\s;]+)/))?d[1].split("/"):[];var e=/(?:^|;)\s*micron\s*=\s*1\s*(?:$|;)/.test(document.cookie);
d={name:d[0],version:d[1],isMicron:e};e=document.cookie.match(/(?:^|;)\s*amzn-app-ctxt\s*=\s*\d\.\d?\s*([^\s;]+)/);try{var g=e?JSON.parse(decodeURIComponent(e[1])):""}catch(D){g=""}e=b.getState("dpx-nice-state");a=Object.assign({timestamp:l(new Date),producerId:"mshop-nile",metadata:'{"program":"blue-dpx"}',isBeta:!1,deviceTypeId:g&&g.di&&g.di.dti||"",directedCustomerId:e&&e.directedCustomerId||"",appVersion:d&&d.version||"",locale:e&&e.locale||"UNKNOWN",marketplaceId:e&&e.marketplaceId||"UNKNOWN",
uxSessionId:"",sessionId:v()||""},a);"undefined"!==typeof ue&&ue.event(f(a),"mshop-nile",c)}function w(a,c){var d=a.luggage,e=d.items[a.key];if(c=c[0])c.isIntersecting?(e.impressingStartAt=new Date,d.visibleElems.add(e.key)):e.impressingStartAt&&(e.impressingEndAt=new Date,e.reason=null!=c.rootBounds?"SCROLLED_AWAY":"REMOVED",t(a),e.impressingStartAt=null,e.impressingEndAt=null,d.visibleElems.remove(e.key))}function m(a){var c=a.luggage.items[a.key];c.impressingStartAt&&"visible"!==document.visibilityState&&
(document.contains(c.elem)&&(c.impressingEndAt=new Date,c.reason="PAGE_HIDDEN",t(a)),document.removeEventListener("visibilitychange",c.pageVisibilityChangeListener))}function x(a,c){a.chunks.addFromEvent(c)}function q(a,c,d){a.requestEndAt=new Date;c=a.chunks.markAsRendered(c);if(d&&d[0]){var e=d[0].matches("[data-blue-request-id]")&&d[0]||d[0].querySelector("[data-blue-request-id]");if(e)for(a.requestId=e.dataset.blueRequestId,p({schemaId:"mshop.nile.events.4",eventTimeUTC:l(a.requestStartAt),nileRequestId:a.requestId,
clickstreamRequestId:null,eventName:"INVOKE_NILE_BACKEND_API",eventDetail:void 0},"mshop.nile.events.4"),d=d.find("[data-blue-metrics]"),e=k(y,a),a.visibilityChangeListenerForLatency=e,document.addEventListener("visibilitychange",a.visibilityChangeListenerForLatency),e=0;e<d.length;e++){var g=d[e],b=h(g);if(a.items[b])a.items[b].elem=g;else{a.items[b]={key:b,elem:g,name:g.dataset.blueMetrics,detail:g.dataset.actionId};var f=c;p({schemaId:"mshop.nile.latency.6",nileRequestId:a.requestId,elementId:g.dataset.actionId,
seqId:f.index,requestStartTimeUTC:l(a.requestStartAt),renderingStartTimeUTC:l(f.renderingStartAt),renderingEndTimeUTC:l(f.renderingEndAt),interruptedTimeUTC:""},"mshop.nile.latency.6")}b=g={luggage:a,key:b};f=b.luggage.items[b.key];f.elem.observer||(f.elem.observer=new IntersectionObserver(k(w,b),{threshold:.85}),f.elem.observer.observe(f.ghost||f.elem),f.pageVisibilityChangeListener||(f.pageVisibilityChangeListener=k(m,b),document.addEventListener("visibilitychange",f.pageVisibilityChangeListener)));
b=g.luggage.items[g.key];b.elem.clickListener||(b.elem.clickListener=k(z,g),b.elem.addEventListener("click",b.elem.clickListener))}}}function A(a,c){a.requestEndAt=new Date;document.removeEventListener("visibilitychange",a.visibilityChangeListenerForLatency)}function y(a){if("visible"!==document.visibilityState&&!a.requestEndAt){a.interruptedAt=new Date;var c=a.flow.toUpperCase(),d=a.chunks.maybeGetLastRendered();p({schemaId:"mshop.nile.latency.6",nileRequestId:a.requestId,elementId:c,seqId:d?d.index+
1:0,requestStartTimeUTC:l(a.requestStartAt),renderingStartTimeUTC:"",renderingEndTimeUTC:"",interruptedTimeUTC:l(a.interruptedAt)},"mshop.nile.latency.6");Object.keys(a.items)}}function t(a){var c=a.luggage;a=c.items[a.key];p({schemaId:"mshop.nile.impressions.1",nileRequestId:c.requestId,elementId:a.detail||a.name,seqId:a.chunkId||0,requestStartTimeUTC:l(c.requestStartAt),impressionStartTimeUTC:l(a.impressingStartAt),impressionEndTimeUTC:l(a.impressingEndAt),impressionEndReason:a.reason},"mshop.nile.impressions.1")}
function z(a){var c=a.luggage.items[a.key];p({schemaId:"mshop.nile.events.4",eventTimeUTC:l(new Date),nileRequestId:a.luggage.requestId,clickstreamRequestId:null,eventName:c.name,eventDetail:c.detail},"mshop.nile.events.4")}function l(a){return a instanceof Date?a.toISOString():""}function B(a){a=(a=(a=a&&a.event&&a.event.refTarget)&&a.closest("[data-blue-metrics]"))&&a.dataset&&a.dataset.actionId;return/^[a-z][a-z0-9]*(?:_[a-z0-9]+)*_\d_\d+$/.test(a)?a:n}function C(a){return{flow:a.flow,actionId:B(a),
chunks:{length:0,addFromEvent:function(a){var c={event:a,renderingStartAt:new Date,index:this.length};a.index=c.index;return[].push.call(this,c)},getFromEvent:function(a){return this[a.index]},maybeGetLastRendered:function(){for(var a=this.length,d=0;d<a&&this[d].renderingEndAt;d++);return 0===d?null:this[d-1]},markAsRendered:function(a){a=this.getFromEvent(a);a.renderingEndAt=new Date;return a}},requestStartAt:new Date,requestEndAt:null,answer:{},visibleElems:{length:0,add:function(a){this[a]||[].push.call(this,
a)},remove:function(a){delete this[a]}},items:{}}}function v(){var a=document.cookie.match(/(?:^|;)\s*session-id\s*=\s*([^\s;]+)/);return a?a[1]:""}var u={};return{executeAndLogMetrics:function(a,c){c=C(c);var d=u.luggage;d&&(document.removeEventListener("visibilitychange",d.visibilityChangeListenerForLatency),d.answer&&d.answer.observer&&(d.answer.observer.unobserve(d.answer.elem),document.removeEventListener("visibilitychange",d.answer.visibilityChangeListener)));u.luggage=c;c={afterFullRender:k(A,
c),beforePillRender:k(x,c),afterPillRender:k(q,c)};a(c)},buildContext:function(a,c){return{flow:a,event:c}}}})});h.when("A","dp-latency-marker").execute(function(b){function q(b,p){var f,h=new Promise(function(b){f=setTimeout(function(){b("timeout")},p)});b=b();return Promise.race([b,h]).then(function(b){clearTimeout(f);return b})}function k(){return new Promise(function(f){h.when("rufus-eligible").execute(function(){b.declarative("dpx-rufus-connect","click",function(b){b.$currentTarget.find(".ask-pill").length?
m.P.now("rufus-handle-expand").execute(function(b){b&&b("NileRelatedQuestionIngress")}):m.P.when("rufus-handle-stream").execute(function(f){f&&(ue&&ue.count&&ue.count("RUFUS_DPX_ATF_PILL_CLICK_SENT_TO_RUFUS_DESKTOP",1),f({qis:"What do customers say?"===b.data.query?"NileNDSWDCSRelatedQuestion":"NileRelatedQuestionIngress",query:b.data.query,metricName:"BlueDPXIngress"}))})});f("resolved")})})}function r(){q(k,50).then(function(f){"timeout"===f&&h.now("rufus-eligible").execute("hide-dpx-widget",function(f){f===
n&&b.$("#dpx-nice-widget-container").hide(0)})}).catch(function(f){b.$("#dpx-nice-widget-container").hide(0)})}r();b.on("PageRefresh:ATF",r)});h.when("A","nile-inline-widget-instrumentation","dp-latency-marker").execute(function(b,h){(function(){var k=h.buildContext("pills");h.executeAndLogMetrics(function(h){var f={type:"default_pills"};h.beforePillRender(f);h.afterPillRender(f,b.$("#dpx-nice-widget-container"))},k)})()})});