(function(k){var g=window.AmazonUIPageJS||window.P,p=g._namespace||g.attributeErrors,c=p?p("PuffAuiAssets",""):g;c.guardFatal?c.guardFatal(k)(c,window):c.execute(function(){k(c,window)})})(function(k,g,p){k.when("A","PuffOrchestrator","PuffTrackingUtils","afterLoad").execute("PuffEntryPoint",function(c,a,h){h.startTimer(h.TOTAL_TIME_TIMER_NAME);a.orchestrate()});"use strict";k.when("A","PuffServiceHelper","PuffServiceResponseHandler","PuffSuppressionManager","PuffTrackingUtils","ready").register("PuffOrchestrator",
function(c,a,h,f,b){return{orchestrate:function(){try{f.isCurrentlySuppressed()?(b.recordTotalTime("ActiveSuppression"),b.recordTotalTime()):a.callGetContent().done(function(a,e,l){h.handleGetContentSuccess(a,e,l);b.recordTotalTime("Success")}).fail(function(a,e,l){h.handleGetContentError(a,e,l);b.recordTotalTime("Failed")}).always(function(){return b.recordTotalTime()})}catch(d){b.logError("Uncaught error during Puff orchestration. Due to: "+d.message),b.recordTotalTime("Failed"),b.recordTotalTime()}}}});
"use strict";k.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffServiceHelper",function(c,a,h){var f=function(){var a=h.getPageTypeValues();return{pageType:a.pageType,subPageType:a.subPageType,referrer:document.referrer,hostName:g.location.host,path:g.location.pathname,queryString:g.location.search}};return{callGetContent:function(){a.startTimer("GetContentTimer");return c.$.ajax("/puff/content",{data:{data:JSON.stringify(f())}}).done(function(b,d,e){a.recordTimer("GetContentTimer",
"GetContentTime:Success");a.recordTimer("GetContentTimer","GetContentTime:Status:"+e.status)}).fail(function(b,d,e){a.recordTimer("GetContentTimer","GetContentTime:Fail");a.recordTimer("GetContentTimer","GetContentTime:Status:"+b.status)}).always(function(){a.recordTimer("GetContentTimer","GetContentTime")})},callRecordImpression:function(b,d,e,l){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:l};d=c.$.extend({},f(),d);a.startTimer("RecordImpressionTimer");return c.$.ajax("/puff/impression",
{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Success");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Fail");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+e.status)}).always(function(){a.recordTimer("RecordImpressionTimer","RecordImpressionTime")})},
callOptOut:function(b,d,e,l){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:l};d=c.$.extend({},f(),d);return c.$.ajax("/puff/opt-out",{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Success");a.recordTimer("OptOutTimer","OptOutTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Fail");a.recordTimer("OptOutTimer","OptOutTime:Status:"+
e.status)}).always(function(){a.recordTimer("OptOutTimer","OptOutTime")})}}});"use strict";k.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffSuppressionManager",function(c,a,h){var f=function(){return JSON.parse(localStorage.getItem("puff:suppression")||"{}")};return{isCurrentlySuppressed:function(){return a.runWithTimer(function(){try{var b,d=h.getSessionId();b=d?f()[d]:p;return Date.parse(b&&b.suppressUntil)>Date.now()}catch(e){return a.emitMetric("SuppressionCheckThrew"),
a.logError("Couldn't check suppression status. Defaulting to not suppressed. Message: "+e.message),!1}},"CheckIsSuppressedTime")},saveSuppression:function(b){return a.runWithTimer(function(){try{var d;var e=h.getSessionId();if(e)if(b.suppressUntil&&Date.parse(b.suppressUntil)){var l=f();l[e]=b;localStorage.setItem("puff:suppression",JSON.stringify(l));d=!0}else a.logError("Suppression not valid. Got: "+JSON.stringify(b)),d=!1;else a.logError("Can't save suppression. No sessionId available."),d=!1;
return d}catch(c){return a.emitMetric("SuppressionSaveThrew"),a.logError("Failed to save suppression. "+c.message),!1}},"SaveSuppressionTime")}}});"use strict";k.when("A","PuffSuppressionManager","PuffRenderingHandler","PuffTrackingUtils","PuffServiceHelper","ready").register("PuffServiceResponseHandler",function(c,a,h,f,b){var d=function(){return c.$(".nav-input")&&c.$(".nav-input").is(":focus")?(f.recordTotalTime("SearchActive"),!0):!1};return{handleGetContentSuccess:function(e,l,m){if(e&&204!==
m.status)switch(f.recordTotalTime(e.responseType),e.responseType){case "SUPPRESSION":a.saveSuppression(e.suppression);f.recordTotalTime("Suppressed");break;case "IMPRESSIONABLE_NO_RENDER":d()||(b.callRecordImpression(e.csrfToken,e.periodicDisplayIdentifier,e.campaignIdentifier,e.placementIdentifier),e.suppression&&(f.recordTotalTime("SuppressedAfterImpression"),a.saveSuppression(e.suppression)),f.recordTotalTime("ImpressionableNoRender"));break;case "RENDERED_FALLBACK":case "RENDERED_PRIMARY":if(!d()){try{c.$("body").append(e.content),
c.state.parse(),h.handle(e)}catch(n){throw f.emitMetric("DisplayFailed"),Error("Problem adding content to body or rendering. "+n.message);}f.recordTotalTime("Rendered")}break;default:f.logWarning("Got an unexpected responseType: "+e.responseType),f.recordTotalTime("UnsupportedResponseType")}else f.recordTotalTime("NoRender")},handleGetContentError:function(a,b,d){d="";try{d=JSON.parse(a.responseText).message}catch(c){d="Couldn't parse responseText. Got: "+(a.responseText&&a.responseText.substring(0,
200))}f.logError("Error calling puff service getContent. Status: "+a.status+". TextStatus: "+b+". Message: "+d)}}});"use strict";k.when("A","a-popover","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffPopoverRenderer",function(c,a,h,f){var b=function(a,b){var l="a:popover:afterHide:"+a.contentId,f=m(b),h=f,k=f.parent().css("position");k&&"static"!==k.toLowerCase()||f.parent().css("position","relative");var f=n(f),q=function(){f.css({top:h.position().top,left:h.position().left})};
c.$(g).bind("resize",q);e(l,f,h,k,q);return d(a,f,l,b)},d=function(b,d,e,c){var h=l(b).detach(),m=c.customCssClass;c={name:b.contentId,inlineContent:h.addClass("show")[0].outerHTML,header:b.header,hideHeader:b.hideHeader,width:c.width,position:c.position};var n=a.create(d,c);"Gateway"===f.getPageTypeValues().pageType&&n.lock();n.show();m&&n.$popover.addClass(m);return{dismissXEventName:"a:popover:dismiss:"+b.contentId,afterHideEventName:e,hideFunction:function(){"Gateway"===f.getPageTypeValues().pageType&&
n.unlock();n.hide()},displayedPuffContentSelector:n.getContent()}},e=function(b,d,e,f,l){c.on(b,function(b){a.remove(d);d.remove();c.$(g).unbind("resize",l);e.parent().css("position",f)})},l=function(a){var b=c.$("#"+a.contentId);if(!b.length)throw h.emitMetric("PopoverRenderer:NoHiddenContent"),Error("No content for popover found at id: "+a.contentId);return b},m=function(a){var b=c.$(a.trigger);if(!b.length)throw h.emitMetric("PopoverRenderer:NoAnchorContent"),Error("No content to anchor popover to at: "+
a.trigger);return b},n=function(a){var b=c.$("\x3cspan/\x3e").css({display:"block",width:a.outerWidth(!0),height:a.outerHeight(!0),position:"absolute",top:a.position().top,left:a.position().left});b.insertAfter(a);return b};return{render:function(a,d){return h.runWithTimer(function(){return b(a,d)},"DisplayPopoverTime")}}});"use strict";k.when("A","PuffPopoverRenderer","PuffDismissHandler","PuffOptOutHandler","PuffServiceHelper","PuffSuppressionManager","PuffTrackingUtils","PuffCtaHandler","ready").register("PuffRenderingHandler",
function(c,a,h,f,b,d,e,l){var m=["contentId","showHeader"],n=function(){var a=c.state("paladin-dynamic-content-state");if(!a)throw e.emitMetric("NoDynamicState"),Error("No paladin-dynamic-content-state page state found.");m.forEach(function(b){if(!a[b])throw e.emitMetric("MissingDynamicStateKey"),Error("Puff dynamic state does not have value for: "+b);});return a};return{handle:function(c){var m;m=n();var g=c.type;switch(g){case "popover":m=a.render(m,c);break;default:throw Error("Invalid puff content type: "+
g);}e.recordTotalTime("Displayed");e.emitEvent("smi_puff_impression",c.periodicDisplayIdentifier+":"+c.campaignIdentifier+":"+c.placementIdentifier);b.callRecordImpression(c.csrfToken,c.periodicDisplayIdentifier,c.campaignIdentifier,c.placementIdentifier);c.suppression&&(e.recordTotalTime("SuppressedAfterImpression"),d.saveSuppression(c.suppression));var g=m.afterHideEventName,k=m.displayedPuffContentSelector;h.init(k,m.dismissXEventName,g,m.hideFunction,c);f.init(c,k,g);l.init(k,g,c)}}});"use strict";
k.when("A","PuffServiceHelper","PuffTrackingUtils","ready").register("PuffOptOutHandler",function(c,a,h){var f=void 0,b=void 0,d=void 0,e=void 0,l=!1,m=function(){l||(a.callOptOut(d.csrfToken,d.periodicDisplayIdentifier,d.campaignIdentifier,d.placementIdentifier),h.emitEvent("smi_puff_optOut",d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),h.recordTimer("DisplayTimeUntilOptOut"),f.undelegate("a","click",n),c.off(e,g),l=!0)},n=function(a){c.$(a.currentTarget).hasClass("opt-out")&&
m()},g=function(){0<b.find("input:checked").length&&m()};return{init:function(a,l,m){h.startTimer("DisplayTimeUntilOptOut");f=l;e=m;b=f.find(".opt-out");d=a;f.delegate("a","click",n);c.on(m,g)}}});"use strict";k.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffDismissHandler",function(c,a,h){var f=!1,b="dismiss_bkgrnd",d="Dismiss:Background",e=!1,l=!1,m=!1,g=void 0,k=void 0,p=void 0,x=void 0,r=void 0,u=void 0,y=void 0,q=function(a,c){e||(b=a,d=c,e=!0)},z=function(){q("dismiss_btn",
"Dismiss:Button")},A=function(){q("dismiss_x","Dismiss:X")},B=function(){m||(a.emitEvent("smi_puff_"+b,u.periodicDisplayIdentifier+":"+u.campaignIdentifier+":"+u.placementIdentifier),a.recordTimer("DisplayTime"),a.emitMetric(d),m=!0);f||(p.unbind("click",z),c.off(k,A),c.off(g,B),r.undelegate("a","click",C),f=!0)},v=function(){l||f||(x(),l=!0)},D=function(){c.$("#nav-search").click(function(){q("dismiss_navSearch","Dismiss:NavSearch");v()})},w=function(a){y=c.delay(function(){q("dismiss_auto","Dismiss:Auto");
v()},a)},E=function(){r.mouseenter(function(){clearTimeout(y)});r.mouseleave(function(){w(1E4)})},C=function(a){c.$(a.currentTarget).hasClass("opt-out")&&(q("dismiss_optOut","Dismiss:OptOut"),v())};return{init:function(b,d,e,l,f){a.startTimer("DisplayTime");g=e;k=d;x=l;r=b;u=f;p=r.find(".dismiss");"Gateway"===h.getPageTypeValues().pageType?(D(),w(1E4)):w(7E3);E();p.click(z);c.on(k,A);c.on(g,B);r.delegate("a","click",C)}}});"use strict";k.when("A","ready").register("PuffTrackingUtils",function(c){var a=
{},h=function(b){a[b]=Date.now()},f=function(b){return a[b]&&Date.now()-a[b]},b=function(a,b){var c=-1!==a.indexOf(b,a.length-b.length);return a+(c?"":b)},d=function(a){var c=1<arguments.length&&arguments[1]!==p?arguments[1]:a,c=b(c,":ms"),d=f(a);d!==p&&e(c,d);return d},e=function(a){var c=1<arguments.length&&arguments[1]!==p?arguments[1]:1;g.ue&&g.ue.count&&(a=b(a,":"),g.ue.count("Paladin:PUFF:"+a,c))};return{TOTAL_TIME_TIMER_NAME:"TotalTime",emitMetric:e,emitEvent:function(a){var b=1<arguments.length&&
arguments[1]!==p?arguments[1]:null;a&&"undefined"!==typeof g.csa&&g.csa("Events",{producerId:"ab-puff"})("log",{schemaId:"abpuff.schema.TrackingRecord.1",refTag:a,campaign:b})},startTimer:h,measureTimer:f,runWithTimer:function(a,b){var c=2<arguments.length&&arguments[2]!==p?arguments[2]:b;h(b);var e=a();d(b,c);return e},recordTimer:d,recordTotalTime:function(){return d("TotalTime","TotalTime:"+(0<arguments.length&&arguments[0]!==p?arguments[0]:"ms"))},logWarning:function(a){k.log(a,"WARN","Paladin:PuffAuiAssets")},
logError:function(a){k.log(a,"ERROR","Paladin:PuffAuiAssets")}}});"use strict";k.when("A","PuffTrackingUtils","ready").register("PuffRequestAttributeUtils",function(c,a){var h=function(){var b=g.ue_pty;return b?b:(a.emitMetric("UeptyUnavailable"),p)},f=function(){var b=g.ue_spty;return b?b:(a.emitMetric("UesptyUnavailable"),p)};return{getPageTypeValues:function(){return g.uept?g.uept.pageType?{pageType:uept.pageType,subPageType:uept.subPageType||f()}:(a.emitMetric("UeptPageTypeUnavailable"),{pageType:h()||
"Unknown",subPageType:uept.subPageType||f()}):(a.emitMetric("UeptUnavailable"),{pageType:h()||"Unknown",subPageType:f()})},getSessionId:function(){if(g.ue&&g.ue.sid)return g.ue.sid;a.emitMetric("UeSidUnavailable");var b=g.ue_sid;b||a.emitMetric("Ue_SidUnavailable");return b}}});"use strict";k.when("A","PuffTrackingUtils","ready").register("PuffCtaHandler",function(c,a){var h=!1,f=!1,b=void 0,d=void 0,e=void 0,g=function(){h||(b.unbind("click",k),c.off(e,n),h=!0)},k=function(){f||(a.emitEvent("smi_puff_cta",
d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),a.recordTimer("DisplayUntilCta"),f=!0);g()},n=function(){g()};return{init:function(f,g,h){a.startTimer("DisplayUntilCta");e=g;d=h;b=f.find(".puff-cta");b.click(k);c.on(g,n)}}})});