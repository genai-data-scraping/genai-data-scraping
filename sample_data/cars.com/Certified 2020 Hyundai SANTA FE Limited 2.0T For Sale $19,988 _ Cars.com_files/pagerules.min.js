/*!
 * ActivEngage - Pageview JS
 * Version: 1.7.790
 */
__ae([11],{114:function(e,s,i){"use strict";e.exports={modules:{invite:"invite",launcher:"launcher",activtarget:"activtarget",digitalRetailing:"digitalretailing"},displayRules:{always:"always",interval:"interval",timeOnSite:"timeOnSite",afterXPages:"pages",afterXPagesInPageGroup:"pagesInPageGroup",return:"return"}}},44:function(e,s,i){"use strict";function t(e){e&&"object"==(void 0===e?"undefined":a(e))||(c.warn("Page Rules was loaded without a configuration."),e={}),this.config=e,this.pageGroups=e.groups||{},this.rules=e.rules||[],this.dependencies={},this.processed={},this.initialize=this.initialize.bind(this),this.saveDependencies=this.saveDependencies.bind(this),this.processRules=this.processRules.bind(this),this.pageRulesFinishedProcessing=this.pageRulesFinishedProcessing.bind(this),this.dispose=this.dispose.bind(this),u.loadDependencies(d).done(this.saveDependencies),this.initialize()}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(1).commands,r=i(1).events,u=i(31),l=i(76),o=i(3),c=i(2),p=i(114),d=[u.modules.wsp],g={activTargetReturnToSiteMinutes:10,cookies:{lastInviteLaunched:"ae-invite-launched"}};t.prototype={dependencies:{},rules:[],processed:{},processTimeout:null,moduleTypes:u.modules,initialize:function(){r.onPageGroupDetected.subscribe(this.processRules),r.onVisitHistoryAvailable.subscribe(this.processRules),r.onReprocessPageRules.subscribe(this.processRules),n.unload.subscribe(this.dispose)},dispose:function(){r.onPageGroupDetected.unsubscribe(this.processRules),r.onVisitHistoryAvailable.unsubscribe(this.processRules),r.onReprocessPageRules.unsubscribe(this.processRules),n.unload.unsubscribe(this.dispose)},saveDependencies:function(e){this.dependencies=e,this.processRules()},getRules:function(){return this.rules},setRules:function(e){this.rules=e},processRules:function(e){if(this.dependencies.wsp){var s=this.dependencies.wsp.activePageGroup;if(String.isNullOrEmpty(s))return void this.pageRulesFinishedProcessing([]);var i=[],t=!1,a=!1;o.foreach(this.rules,function(n){if(n.pagegroups instanceof Array)switch(n.module){case u.modules.invite:n.pagegroups.includes(s)&&(this.processInviteRule(n,s),i.push(n));break;case u.modules.launcher:t=!0,n.pagegroups.includes(s)&&(this.processLauncherRule(n,s),i.push(n));break;case u.modules.activtarget:n.pagegroups.includes(s)&&(this.processActivTargetRule(n,s,e),i.push(n));break;case u.modules.digitalRetailing:n.pagegroups.includes(s)&&(a=!0,this.processDigitalRetailingRule(n,s,e),i.push(n))}}.bind(this)),t||(c.debug("No pagerules found for launcher falling back."),n.launchLauncher.trigger()),a||(c.debug("DigitalRetailing: Page rules not found for active pagegroup."),n.registerDigitalRetailing.trigger({render:!1})),this.pageRulesFinishedProcessing(i)}},pageRulesFinishedProcessing:function(e){r.onPageRulesFinishedProcessing.trigger(e)},processLauncherRule:function(e,s){if(s||(s=this.dependencies.wsp.activePageGroup),e&&"object"==(void 0===e?"undefined":a(e))&&s){if(!e.pagegroups.includes(s))return void n.launchLauncher.trigger({template:e.template,render:!1});var i,t;switch(i="unknown",-1,t=!1,e.displayrule&&"object"==a(e.displayrule)&&(i=e.displayrule.type,parseInt(e.displayrule.value)),i){case p.displayRules.always:t=!0;break;default:c.debug("Unknown launcher display rule:"+i+"."),t=!0}return t&&(c.debug("Rule for launcher has been matched, type="+i+". Preparing Launcher, id="+e.template+"."),n.launchLauncher.trigger({template:e.template,render:!0})),t}},processInviteRule:function(e,s){if(s||(s=this.dependencies.wsp.activePageGroup),e&&"object"==(void 0===e?"undefined":a(e))&&!this.processed[u.modules.invite]&&s){var i,t,r,d,h;switch(i="unknown",t=-1,r=!1,e.displayrule&&"object"==a(e.displayrule)&&(i=e.displayrule.type,t=parseInt(e.displayrule.value)),i){case p.displayRules.always:h=parseInt(o.getCookie(g.cookies.lastInviteLaunched)),r=!0;break;case p.displayRules.interval:h=parseInt(o.getCookie(g.cookies.lastInviteLaunched)),d=new Date-(h?new Date(h):l.getVisitStartDate()),d=t-d,d<=0?r=!0:(c.debug("Setting timeout for "+Math.round(d/1e3)+" seconds to launch invite."),this.processTimeout&&clearTimeout(this.processTimeout),this.processTimeout=setTimeout(this.processRules,d));break;case p.displayRules.timeOnSite:new Date-l.getVisitStartDate()>=t&&(r=!0);break;case p.displayRules.afterXPages:l.getClickPath().length>t&&(r=!0);break;case p.displayRules.afterXPagesInGroup:c.debug("TODO: Invite rule for afterXPagesInGroup has not been implemented yet.");break;default:c.debug("Unknown invite display rule:"+i+"."),r=!0}return r&&(c.debug("Rule for invite has been matched, type="+i+". Launching Invite."),n.launchInvite.trigger({template:e.template}),this.processed[u.modules.invite]=!0),r}},processActivTargetRule:function(e,s,i){if(s||(s=this.dependencies.wsp.activePageGroup),e&&"object"==(void 0===e?"undefined":a(e))&&!this.processed[u.modules.activtarget]&&s){var t,r,o;switch(t="unknown",r=-1,o=!1,e.displayrule&&"object"==a(e.displayrule)&&(t=e.displayrule.type,r=parseInt(e.displayrule.value)),t){case p.displayRules.return:i&&(!0===i.tabReturn?o=!0:i.visitorReturn&&i.visitorReturn.minutes>=g.activTargetReturnToSiteMinutes&&(o=!0));break;case p.displayRules.afterXPages:l.getClickPath().length>r&&(o=!0);break;case p.displayRules.timeOnSite:new Date-l.getVisitStartDate()>=r&&(o=!0);break;default:console.log("Unknown ActivTarget display rule:"+t+"."),o=!0}return o&&(c.debug("Rule for ActivTarget has been matched, type="+t+". Launching ActivTarget."),n.launchActivTarget.trigger({template:e.template}),this.processed[u.modules.activtarget]=!0),o}},processDigitalRetailingRule:function(e,s,i){if(s||(s=this.dependencies.wsp.activePageGroup),e&&"object"==(void 0===e?"undefined":a(e))&&!this.processed[u.modules.digitalRetailing]&&s){var t,r;switch(t="unknown",-1,r=!1,e.displayrule&&"object"==a(e.displayrule)&&(t=e.displayrule.type,parseInt(e.displayrule.value)),t){case p.displayRules.always:r=!0;break;default:console.log("Unknown DigitalRetailing display rule:"+t+"."),r=!0}r&&(c.debug("Rule for Digital has been matched, type="+t+". Preparing Launcher, id="+e.template+"."),n.registerDigitalRetailing.trigger({render:!0}))}}},e.exports=t}});